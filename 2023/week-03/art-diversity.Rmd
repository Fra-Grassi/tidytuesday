---
title: "art-diversity"
author: "Francesco Grassi"
date: "2023-01-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages(library(tidyverse))
options(dplyr.summarise.inform = FALSE)
```

# Aim

Visualize representation of genders and races in the years across publications of Janson’s History of Art and Gardner’s Art Through the Ages.

This is also an exercise into **waffle charts**. We'll use them to display number of entries in the data-set per gender and race.

# Libraries
```{r}

# remotes::install_github("hrbrmstr/waffle")
# devtools::install_github("thomasp85/scico")

# library(tidytuesdayR)
library(tidyverse)
library(waffle)
library(scico)  # scientific colour maps
library(patchwork)
# library(geomtextpath)
# library(scales)
```

# Load TidyTuesday's data

```{r}
# tuesdata <- tt_load(2023, week = 3)
# main_df <- tuesdata$artists
# write_csv(main_df, file = "data/raw-data.csv")
main_df <- read_csv("data/raw-data.csv")
```

# Prepare data

First, lets' factorize artist's gender and race. In both cases, order levels from by frequency:
```{r}
main_df <- main_df %>% 
  mutate(artist_gender = fct_infreq(artist_gender),
         artist_race = fct_infreq(artist_race))
```

Now, we are going to use "geom_waffle()" in order to create the waffle plots. This function requires a variable with a **count** measure, which will be used to define the number of squares to plot. Therefore, let's create two dfs, one summarizing the number of artists per gender per year, and the other the number of artists per race per year:
```{r}
df_gender <- main_df %>% 
  group_by(year, artist_gender) %>% 
  summarise(n = n())

df_race <- main_df %>% 
  group_by(year, artist_race) %>% 
  summarise(n = n())
```

Level names for artist race are quite long. Add a new variable which breaks the longer ones in two lines:
```{r}
df_race <- df_race %>% 
  mutate(race_plot = artist_race) %>% 
  mutate(rece_plot = fct_recode(race_plot, 
                                "American Indian \\\nAlaska Native" = "American Indian or Alaska Native", 
                                "Black \\\nAfrican American" = "Black or African American", 
                                "Native Hawaiian \\\nOther Pacific Islander" = "Native Hawaiian or Other Pacific Islander"))
```

# Plot

## General settings

Since we are creating different plots, let's define some general settings.  
Colors for the palettes are taken by the [scico package by thomasp85](https://github.com/thomasp85/scico), which is an implementation of the amazing colormaps by [Fabio Crameri](https://www.fabiocrameri.ch/colourmaps/).
```{r}

text_main <- 16  # main plot text size
text_title <- 40
text_axis_title <- 20

```


## Gender

Let's start with gender. As we said, we want to create a waffle chart, displaying number of artists per year of publication, divided by gender:
```{r, fig.width=20, fig.height=12}
plot_gender <- df_gender %>% 
  ggplot(aes(fill = artist_gender, values = n)) +
  geom_waffle(color = "white", size = .20, n_rows = 5, flip = TRUE) +
  facet_wrap( ~ year, nrow = 1, strip.position = "bottom") +
  scale_x_discrete() +
  scale_y_continuous(limits = c(0, 80),  # keep in mind each row contains 5 values! (see line below)
                     labels = function(x) x * 5,  # multiply for the same number as "n_rows" in "geom_waffle()" to display correct labels
                     expand = c(0, 0)) +
  labs(x = "Year", y = "Count") +
  scale_fill_scico_d(palette = "acton", direction = -1) +
  coord_equal() +
  theme_minimal() +
  theme(
    plot.margin = margin(0.2, 0, 0.2, -0.2, "in"),
    panel.grid.minor = element_blank(),
    axis.title = element_text(size = text_axis_title),
    axis.title.x = element_text(margin = margin(0.1, 0, 0, 0, "in")),
    axis.title.y = element_text(margin = margin(0, 0.1, 0, 0, "in")),
    axis.text = element_text(size = text_main, color = "black"),
    legend.position = "bottom",
    legend.title = element_blank(),
    legend.text = element_text(size = text_main),
    strip.text = element_text(size = text_main)
    )
```

# Race

We do the same thing for race:
```{r, fig.width=20, fig.height=12}
plot_race <- df_race %>% 
  ggplot(aes(fill = race_plot, values = n)) +
  geom_waffle(color = "white", size = .20, n_rows = 5, flip = TRUE) +
  facet_wrap( ~ year, nrow = 1, strip.position = "bottom") +
  scale_x_discrete() +
  scale_y_continuous(limits = c(0, 80),  # keep in mind each row contains 5 values! (see line below)
                     labels = function(x) x * 5,  # multiply for the same number as "n_rows" in "geom_waffle()" to display correct labels
                     expand = c(0, 0)) +
  labs(x = "Year", y = "Count") +
  scale_fill_scico_d(palette = "acton",
                     direction = -1) +
  coord_equal() +
  theme_minimal() +
  theme(
    plot.margin = margin(1, 0, 0.2, -0.2, "in"),
    panel.grid.minor = element_blank(),
    axis.title = element_text(size = text_axis_title),
    axis.title.x = element_text(margin = margin(0.1, 0, 0, 0, "in")),
    axis.title.y = element_text(margin = margin(0, 0.1, 0, 0, "in")),
    axis.text = element_text(size = text_main, colour = "black"),
    legend.position = "bottom",
    legend.title = element_blank(),
    legend.text = element_text(size = text_main),
    strip.text = element_text(size = text_main)
    )
```

## Combine plots

Combine the two plots in one figure:
```{r, fig.width=17, fig.height=20}
plot_gender + plot_race +
  plot_layout(nrow = 2) +
  plot_annotation(title = "Test this",
                  caption = "test caption",
                  theme = theme(
                    plot.margin = margin(0, 0, 0, -0.7, unit = "in"),
                    plot.title = element_text(size = text_title, hjust = 0.06, margin = margin(0.3, 0, 0.5, 0, unit = "in")),
                    plot.background = element_rect(fill = "#C1D7D7")
  ))
# ggarrange(plot_gender, plot_race, common.legend = FALSE, nrow = 2, align = "h") +
#   theme(plot.margin = margin(1, 0, 0, -0.5, unit = "in"),
#         plot.background = element_rect(fill = "gray50"))

#ggsave(filename = "img/test.png", width = 18, height = 20, unit = "in", dpi = 300)
```

